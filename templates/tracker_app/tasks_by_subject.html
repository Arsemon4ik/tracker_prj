{% extends 'base.html' %}
{% load static %}
{% load index %}
{% block title %}Data sets{% endblock title %}

{% block content %}
    {% include 'navbar.html' %}
    <div class="mx-5">
        <div class="w-75">
            <div class="d-flex justify-content-between">
                <div>
                    <h2 class="py-3">–ó–∞–≤–¥–∞–Ω–Ω—è –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É "{{ subject }}"</h2>
                    <div>
                        <canvas id="myBarChart" width="200" height="150" style="max-height: 400px; min-width: 600px" ></canvas>
                    </div>
                </div>
                <form class="w-25" action="" method="post">
                    <h2 class="py-3">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è</h2>
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="name">–ù–∞–∑–≤–∞</label>
                        {{ form.name }}
                    </div>
                    {#                    <div class="form-group">#}
                    {#                        <label for="subject">–ü—Ä–µ–¥–º–µ—Ç</label>#}
                    {#                        {{ form.subject }}#}
                    {#                    </div>#}
                    <div class="form-group">
                        <label for="score">–ö—ñ–ª. –±–∞–ª—ñ–≤</label>
                        {{ form.score }}
                    </div>
                    <div class="form-group">
                        <label for="deadline">–î–µ–¥–ª–∞–π–Ω</label>
                        {{ form.deadline }}
                    </div>
                    <div class="form-group">
                        <label for="satus">–°—Ç–∞—Ç—É—Å</label>
                        {{ form.status }}
                    </div>
                    <div class="form-group d-flex flex-row-reverse">
                        <button type="submit"
                                name="add_task"
                                class="btn btn-success rounded py-2 px-2 h-25 my-3 border-0">
                            –ù–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è
                        </button>
                    </div>
                </form>
            </div>
            <table class="table table-bordered mb-5">
                <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">–ù–∞–∑–≤–∞</th>
                    {#                    <th scope="col">–°—Ç–≤–æ—Ä–µ–Ω–æ</th>#}
                    <th scope="col">–î–µ–¥–ª–∞–π–Ω</th>
                    <th scope="col">–°—Ç–∞—Ç—É—Å</th>
                    <th scope="col">–ö—ñ–ª. –±–∞–ª—ñ–≤</th>
                </tr>
                </thead>
                <tbody id="data_sets_table">
                {% if tasks %}
                    <form action="" method="post">
                    {% csrf_token %}
                    {{ formset.management_form }}
                    {% for form in formset %}
                        {% for hidden in form.hidden_fields %}
                            {{ hidden }}
                        {% endfor %}
                        {#                        <tr>#}
                        {#                            <th scope="row">{{ forloop.counter }}</th>#}
                        {#                            <td>{{ task.name }}</td>#}
                        {#                            <td>{{ task.created_at|timesince }} —Ç–æ–º—É</td>#}
                        {#                            <td>{{ task.deadline|timeuntil }}</td>#}
                        {#                            <td>#}
                        {#                                {{ task.score }}#}
                        {#                            </td>#}
                        {#                        </tr>#}
                        <tr>
                            <th scope="row">{{ forloop.counter }}</th>
                            <td>{{ form.name }}</td>

                            {#                            <td>{{ tasks|index:1 }} —Ç–æ–º—É</td>#}

                            <td>{{ form.deadline }}</td>
                            <td>{{ form.status }}</td>
                            <td>
                                {{ form.score }}
                            </td>
                        </tr>
                    {% endfor %}
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <th>–í—Å—å–æ–≥–æ:</th>
                        <td>{{ total_score }}</td>
                    </tr>
                    <button type="submit"
                            name="edit_task"
                            class="btn btn-success rounded py-2 px-2 h-25 my-3 border-0">
                        –ó–±–µ—Ä–µ–≥—Ç–∏
                    </button>
                {% endif %}

                </form>
                </tbody>
            </table>
            {% if not tasks %}
                <h2 class="text-center py-4">–ë—É–¥—å-–ª–∞—Å–∫–∞ –¥–æ–¥–∞–π—Ç–µ –≤–∞—à—ñ –∑–∞–≤–¥–∞–Ω–Ω—è üòä</h2>
            {% endif %}

        </div>
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} mb-0 alert-dismissible fade show" role="alert">
                <strong>Message: </strong> {{ message }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        {% endfor %}
    </div>



{% endblock %}

{% block script %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ctxBar = document.getElementById('myBarChart');

        {#let subjects = JSON.parse("{{subject_names}}".replace(/(&quot\;)/g, "\""));#}
        const dataBar = {
            labels: ['–í–∏–∫–æ–Ω–∞–Ω–æ', '–í—Å—å–æ–≥–æ'],
            datasets: [
                {
                    label: ['–í–∏–∫–æ–Ω–∞–Ω–æ', '–í—Å—å–æ–≥–æ'],
                    {#data: JSON.parse("{{task_per_subject}}"),#}
                    data: ["{{ total_done }}", "{{ tasks|length }}"],
                    barPercentage: 1,
                    backgroundColor: [
                        'rgba(80, 200, 120, .8)',
                        'rgba(153, 102, 255, .8)',
                    ],
                    barThickness: 80,

                }
            ]
        };
        const configBar = {
            type: 'bar',
            data: dataBar,
            options: {
                {#responsive: true,#}
                plugins: {
                    legend: {
                        position: 'top',
                    },

                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            },
        };
        new Chart(ctxBar, configBar)
    </script>

    {##}
    {#    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha256-BRqBN7dYgABqtY9Hd4ynE+1slnEw+roEPFzQ7TRRfcg=" crossorigin="anonymous"></script>#}
    {##}
    {#    <script src="https://cdn.jsdelivr.net/npm/@eonasdan/tempus-dominus@6.7.7/dist/js/tempus-dominus.min.js"#}
    {#            crossorigin="anonymous"></script>#}
    {##}
    {##}
    {#    <link rel="stylesheet"#}
    {#          href="https://cdn.jsdelivr.net/npm/@eonasdan/tempus-dominus@6.7.7/dist/css/tempus-dominus.min.css"#}
    {#          crossorigin="anonymous">#}


{% endblock %}
